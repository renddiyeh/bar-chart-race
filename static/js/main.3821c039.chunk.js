(this["webpackJsonpbar-chart-race"]=this["webpackJsonpbar-chart-race"]||[]).push([[0],{127:function(t,e,n){"use strict";n.r(e);var a=n(3),r=n(2),c=n.n(r),i=n(46),o=n.n(i),u=(n(82),n(9)),f=n(23),l=n(11),d=n(41),s=n(138),j=n(139),h=n(144),b=n(135),m=n(141),O=n(136),x=n(54),p=n(140),g=function(t){var e=t.domainMax,n=t.xMax,r=n>500?5:Math.floor(n/100),c=Object(j.a)({domain:[0,e],range:[0,n]});return Object(a.jsx)(p.a,{top:0,left:0,scale:c,tickLabelProps:function(){return{textAnchor:"middle",dy:"-0.25em",fontSize:12}},numTicks:r})},y=Object(O.animated)(g),v=Object(r.forwardRef)((function(t,e){var n=t.domainMax,c=t.xMax,i=t.duration,o=Object(r.useRef)(n).current,u=Object(x.useSpring)({from:{domainMax:o},to:{domainMax:n},duration:i,ref:e});return Object(a.jsx)(y,Object(l.a)({xMax:c},u))})),w=n(137),S=n(145),k=n(146),C=n(142),M=Object(C.a)(".2s"),E=function(t){var e=t.color,n=t.x,r=t.y,i=t.width,o=t.height,u=t.name,f=t.value,l=t.author;return Object(a.jsxs)(c.a.Fragment,{children:[Object(a.jsx)(k.a,{id:"clip-".concat(u),x:n,y:r,width:i,height:o}),Object(a.jsx)(w.a,{x:n,y:r,width:i,height:o,fill:e,stroke:"black",strokeWidth:"1"}),Object(a.jsx)(S.a,{x:n-10,y:r+4+o/2,textAnchor:"end",fontFamily:"Noto Sans TC",fontSize:"16px",children:l}),Object(a.jsx)(S.a,{x:n+i-10,y:r+4+o/2,textAnchor:"end",fontFamily:"Noto Sans TC",fontSize:"16px",clipPath:"url(#clip-".concat(u,")"),children:u}),Object(a.jsx)(S.a,{x:n+i+10,y:r+5+o/2,fontFamily:"Noto Sans TC",fontSize:"20px",fontWeight:"700",children:M(f)})]})},F=Object(O.animated)(E),T=Object(r.forwardRef)((function(t,e){var n=t.frameData,c=t.xScale,i=t.yScale,o=t.colorScale,u=t.duration,f=Object(x.useTransition)(n.map((function(t,e){var n=t.name,a=t.value,r=t.category,o=t.author,u=t.id;return{y:i(e),width:c(a),value:a,name:n,category:r,author:o,key:u}})),{key:function(t){return t.key},initial:function(t){return t},from:{y:i.range()[1]+50,width:0,value:0},leave:{y:i.range()[1]+50,width:0,value:0},enter:function(t){return t},update:function(t){return t},ref:e,duration:u}),l=Object(r.useMemo)((function(){return{x:c(0),height:i.bandwidth()}}),[]),d=l.x,s=l.height;return f((function(t,e){var n=t.y,r=t.value,c=t.width,i=e.category,u=e.name,f=e.author,l=e.key;return Object(a.jsx)(F,{x:d,y:n,width:c,height:s,color:o(i),value:r.interpolate((function(t){return t.toFixed()})),name:u,author:f},l)}))})),W=["\u6587\u5b78\u5c0f\u8aaa","\u5546\u696d\u7406\u8ca1","\u751f\u6d3b\u65c5\u904a","\u5fc3\u7406\u52f5\u5fd7","\u5176\u4ed6"],z=Object(s.a)({domain:W,range:["#F27E7E","#80D2FF","#61C67E","#FFC027","#CCCCCC"]}),I=c.a.forwardRef((function(t,e){var n=t.numOfBars,c=t.width,i=t.height,o=t.margin,s=t.keyframes,O=t.onStart,x=t.onStop,p=t.duration,g=Object(r.useState)({frameIdx:0,animationKey:0,playing:!1}),y=Object(u.a)(g,2),w=y[0],S=w.frameIdx,k=w.animationKey,C=w.playing,M=y[1],E=Object(r.useRef)();Object(r.useEffect)((function(){!E.current&&C&&(E.current=setTimeout((function(){E.current=null,M((function(t){var e=t.frameIdx,n=t.playing,a=Object(d.a)(t,["frameIdx","playing"]),r=e===s.length-1,c=r?e:e+1;return Object(l.a)(Object(l.a)({},a),{},{frameIdx:n?c:e,playing:!(!n||r)})}))}),p))}));var F=Object(r.useRef)(),I=Object(r.useRef)();Object(r.useImperativeHandle)(e,(function(){return{replay:function(){clearTimeout(E.current),E.current=null,M((function(t){var e=t.animationKey,n=Object(d.a)(t,["animationKey"]);return Object(l.a)(Object(l.a)({},n),{},{frameIdx:0,animationKey:e+1,playing:!0})}))},start:function(){M((function(t){return Object(l.a)(Object(l.a)({},t),{},{playing:!0})}))},stop:function(){M((function(t){return Object(l.a)(Object(l.a)({},t),{},{playing:!1})})),F.current.stop(),I.current.stop()},playing:C}}));var R=Object(r.useRef)(C);Object(r.useEffect)((function(){R.current!==C&&(C?O():x()),R.current=C}),[C]),Object(r.useLayoutEffect)((function(){F.current&&C&&(F.current.start(),I.current.start())}));var A=s[S],D=A.date,K=A.data,B=K.map((function(t){return t.value})),L=c-o.left-o.right,N=i-o.top-o.bottom,P=Math.max.apply(Math,Object(f.a)(B)),H=Object(j.a)({domain:[0,P],range:[0,L]}),J=Object(r.useMemo)((function(){return Object(h.a)({domain:W.map((function(t,e){return e})),range:[.1*c,.9*c]})}),[c]),Q=Object(r.useMemo)((function(){return Object(h.a)({domain:Array(n).fill(0).map((function(t,e){return e})),range:[0,N],paddingInner:.2})}),[n,N]),Y="".concat(D.getFullYear(),"Q").concat(Math.floor(D.getMonth()/3)+1),$=c/40;return Object(a.jsxs)("svg",{width:c,height:i,children:[Object(a.jsx)("text",{y:"40",x:c/2,textAnchor:"middle",fontWeight:"700",fontSize:"32px",children:"\u904e\u53bb\u5341\u5e74\u5927\u5bb6\u90fd\u770b\u4e86\u54ea\u4e9b\u66f8\uff1f"}),Object(a.jsx)("line",{x1:"0",y1:"60",x2:c,y2:"60",stroke:"black",strokeWidth:"2"}),Object(a.jsx)(m.a,{scale:z,children:function(t){return Object(a.jsx)(b.a,{top:"80",children:t.map((function(t,e){var n=J(e);return Object(a.jsxs)(b.a,{left:n,children:[Object(a.jsx)("rect",{fill:t.value,width:32,height:32,strokeWidth:"1",stroke:"black"}),Object(a.jsx)("text",{x:35,y:22,fontSize:$,children:t.text})]},e)}))})}}),Object(a.jsx)("line",{x1:"0",y1:"120",x2:c,y2:"120",stroke:"black",strokeWidth:"2"}),Object(a.jsxs)(b.a,{top:o.top,left:o.left,children:[Object(a.jsx)(T,{frameData:K.slice(0,n),xScale:H,yScale:Q,colorScale:z,duration:p,ref:F}),Object(a.jsx)("text",{textAnchor:"end",style:{fontSize:"1.25em"},x:L,y:N,children:Y}),Object(a.jsx)("line",{x1:0,y1:0,x2:0,y2:N,stroke:"black"}),Object(a.jsx)(v,{domainMax:P,xMax:L,duration:p,ref:I})]},k),Object(a.jsx)("rect",{x:0,y:i-o.bottom+40,width:c,height:o.bottom-40,fill:"#CCCCCC"})]})}));I.defaultProps={width:600,height:450,margin:{top:0,right:0,bottom:0,left:100}};var R=I,A=n(40),D=n(143),K=n(59),B=function(t,e){var n=function(t){var e=new Map;return t.forEach((function(t){var n=t.date,a=t.name;if(e.get(n)){var r=Object(l.a)(Object(l.a)({},e.get(n)),{},Object(A.a)({},a,t));e.set(n,r)}else e.set(n,Object(A.a)({},a,t))})),function(t){var n=t.date,a=t.name;try{return e.get(n)[a]}catch(r){return null}}}(t),a=new Set(t.map((function(t){return t.name}))),r=Object(f.a)(a),c=new Set(t.map((function(t){return t.date}))),i=Object(f.a)(c).sort().map((function(t){return{date:t,data:r.map((function(e){var a=n({date:t,name:e});return Object(l.a)(Object(l.a)({},a),{},{value:a?a.value:0})}))}}));return i.reduce((function(t,a,r){var c=a,o=r!==i.length-1?i[r+1]:null;if(o)for(var u=new Date(c.date).getTime(),f=new Date(o.date).getTime()-u,s=function(r){var c=new Date(u+f*r/e),i=a.data.map((function(t){var a=t.name,c=t.value,i=Object(d.a)(t,["name","value"]),u=c,f=n({date:o.date,name:a}),s=u+((f?f.value:0)-u)*r/e;return Object(l.a)({name:a,value:s},i)}));t.push({date:c,data:i})},j=0;j<e;j++)s(j);else t.push(Object(l.a)(Object(l.a)({},a),{},{date:new Date(a.date)}));return t}),[]).map((function(t){return{date:t.date,data:t.data.sort((function(t,e){return e.value-t.value}))}}))};var L=function(t,e){var n=c.a.useState([]),a=Object(u.a)(n,2),r=a[0],i=a[1];return c.a.useEffect((function(){Object(D.a)(t).then((function(t){var n=Object(K.range)(2010,2021).reduce((function(e,n){return Object(K.range)(4).forEach((function(a){var r="".concat(n,"/Q").concat(a+1),c=t.filter((function(t){return t[r]})).map((function(t){return{date:[n,String(3*a+1).padStart(2,"0"),"01"].join("-"),id:t["\u5e8f"],name:t["\u66f8\u540d"],author:t["\u4f5c\u8005"],category:t["\u5206\u985e"],value:Number(t[r]||0)}}));Array.prototype.push.apply(e,c)})),e}),[]),a=B(n,e);i(a)}))}),[t,e]),r};var N=n.p+"static/media/data.658a2e79.tsv",P={top:160,right:60,bottom:120,left:100},H=697/640;var J=function(){var t=Object(r.useState)(250),e=Object(u.a)(t,2),n=e[0],i=e[1],o=function(){var t=function(){return{width:window.innerWidth,height:window.innerHeight}},e=c.a.useState(t),n=Object(u.a)(e,2),a=n[0],r=n[1];return c.a.useEffect((function(){var e=function(){r(t)};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),a}().width,f=Math.min(720,o)-64,l=L(N,10),d=c.a.useRef(),s=!!d.current&&d.current.playing,j=Object(r.useState)(),h=Object(u.a)(j,2),b=(h[0],h[1]);return Object(a.jsx)("div",{style:{margin:"0 auto",maxWidth:720},children:Object(a.jsxs)("div",{style:{paddingTop:"1em"},children:[Object(a.jsx)("button",{onClick:function(){d.current.replay()},children:"replay"}),Object(a.jsx)("button",{onClick:s?function(){d.current.stop()}:function(){d.current.start()},children:s?"stop":"start"}),Object(a.jsx)("input",{type:"number",step:"50",min:"100",max:"1000",onChange:function(t){return i(1*t.target.value)},value:n}),l.length>0&&Object(a.jsx)(R,{keyframes:l,numOfBars:10,width:f,height:f*H,margin:P,onStart:function(){return b(!0)},onStop:function(){return b(!1)},ref:d,duration:n,ratio:H})]})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(a.jsx)(J,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},82:function(t,e,n){}},[[127,1,2]]]);
//# sourceMappingURL=main.3821c039.chunk.js.map